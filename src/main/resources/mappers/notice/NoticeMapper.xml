<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jaspa.healthtouch.notice.model.dao.NoticeMapper">
	<resultMap type="com.jaspa.healthtouch.notice.model.dto.NoticeDTO" id="noticeResultMap">
		<id property="noticeNo" column="NOT_NO"/>
		<result property="memberId" column="NOT_MEMBER_ID"/>
		<result property="noticeTitle" column="NOT_TITLE"/>
		<result property="noticeContent" column="NOT_CONTENT"/>
		<result property="noticeDelete" column="NOT_DELETE"/>
		<result property="noticeDate" column="NOT_DATE"/>
		<result property="noticeEditDate" column="NOT_EDIT_DATE"/>
		<result property="noticeView" column="NOT_VIEW"/>
		
		<association property="member" resultMap="userResultMap"/>
		<collection property="commentList" resultMap="commentResultMap"/>
		<collection property="attachmentList" resultMap="attachmentResultMap"/>
		
	</resultMap >
	
	<resultMap type="com.jaspa.healthtouch.notice.model.dto.AttachmentDTO" id="attachmentResultMap" >
		<id property="attachNo" column="ATC_NO"/>
		<result property="noticeNo" column="ATC_NOT_NO"/>
		<result property="root" column="ATC_ROOT"/>
		<result property="thumbRoot" column="ATC_THUMB_ROOT"/>
		<result property="file" column="ATC_ORIGIN_FILE"/>
		<result property="editFile" column="ATC_EDIT_FILE"/>
		<result property="fileType" column="ATC_FILE_TYPE"/>

		<association property="notice" resultMap="noticeResultMap"/>
	</resultMap>

	<resultMap 	type="com.jaspa.healthtouch.notice.model.dto.CommentDTO" id="commentResultMap"  >
		<id property="no" column="COM_NO"/>
		<result property="id" column="COM_MEMBER_ID"/>
		<result property="noticeNo" column="COM_NOT_NO"/>
		<result property="content" column="COM_CONTENT"/>
		<result property="delete" column="COM_DELETE"/>
		<result property="createDate" column="COM_DATE"/>
		<result property="editDate" column="COM_EDIT_DATE"/>
		
	</resultMap>
	
		<resultMap type="com.jaspa.healthtouch.notice.model.dto.MemberDTO" id="memberResultMap">
		<id property="id" column="MEMBER_ID"/>
		<result property="pwd" column="MEMBER_PWD"/>
		<result property="name" column="MEMBER_NAME"/>
		<result property="contact" column="MEMBER_CONTACT"/>
		<result property="num" column="MEMBER_NUM"/>
		<result property="birthday" column="MEMBER_BIRTHDAY"/>
		<result property="age" column="MEMBER_AGE"/>
		<result property="gender" column="MEMBER_GENDER"/>
		<result property="address" column="MEMBER_ADDRESS"/>
		<result property="type" column="MEMBER_TYPE"/>
		<result property="status" column="MEMBER_STATUS"/>
		
		<association property="memberRole" resultMap="memberRoleResultMap"/>
	</resultMap>
	
	<resultMap type="com.jaspa.healthtouch.notice.model.dto.MemberRoleDTO" id="memberRoleResultMap">
		<id property="memberId" column="REF_MEMBER_ID"/>
		<result property="authorityCode" column="REF_AUTHORITY_CODE"/>
		
		<association property="authority" resultMap="authorityResultMap"/>
	</resultMap>
	
	<resultMap type="com.jaspa.healthtouch.notice.model.dto.AuthorityDTO" id="authorityResultMap">
		<id property="code" column="REF_AUTHORITY_CODE2"/>
		<result property="name" column="AUTHORITY_NAME"/>
		<result property="desc" column="AUTHORITY_DESC"/>
	</resultMap>
	
	
	<insert id="registNoticeFileList" parameterType="notice.notice.model.dto.AttachmentDTO">
      <![CDATA[
        INSERT 
          INTO TBL_ATTACHMENT 
        (
          ATC_NOT_NO
        , ATC_ROOT
        , ATC_ORIGIN_FILE
        , ATC_EDIT_FILE
        , ATC_FILE_TYPE
        , 
        )
        VALUES 
        	]]>
		<foreach collection="list" item="item" separator=",">
        
        (
        , #{ item.noticeNo }
        , #{ item.root }
        , #{ item.file }
        , #{ item.editFile }
        , #{ item.fileType }
        )
        	</foreach>
	</insert>

	
	<insert id="registNotice" parameterType="notice.notice.model.dto.NoticeDTO"
        useGeneratedKeys="true" keyProperty="noticeNo">
        <![CDATA[
        INSERT 
          INTO TBL_NOTICE 
        (
        , NOT_MEMBER_ID  
        , NOT_TITLE
        , NOT_CONTENT
        , NOT_DELETE
        , NOT_DATE
        )
        VALUES
        (
        , #{ memberId }
        , #{ noticeTitle }
        , #{ noticeContent }
       	, 'N'
        , SYSDATE
        )
        ]]>
	</insert>
	
</mapper>